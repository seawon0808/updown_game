<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Up Down ê²Œì„ (ìµœì  ì „ëµ)</title>
<style>
body {
  font-family: system-ui, sans-serif;
  background:#f6f7fb;
  padding:20px;
}
.container {
  max-width:540px;
  margin:auto;
  background:white;
  padding:20px;
  border-radius:12px;
  box-shadow:0 10px 20px rgba(0,0,0,.08);
}
input, button {
  width:100%;
  padding:10px;
  margin-top:8px;
  font-size:16px;
}
button {
  border-radius:8px;
  border:1px solid #ccc;
  background:#fafafa;
  cursor:pointer;
}
.box {
  background:#f1f1f1;
  padding:8px;
  border-radius:6px;
  margin-top:10px;
}
.log {
  margin-top:10px;
  max-height:160px;
  overflow-y:auto;
  font-size:14px;
}
.score {
  font-size:18px;
  margin-top:8px;
}
.small {
  font-size:13px;
  color:#555;
}
</style>
</head>
<body>

<div class="container">
  <h2>Up Down ê²Œì„ (1~100)</h2>

  <div class="score">
    <b id="pscore">0</b> : <b id="cscore">0</b>
  </div>
  <div class="small">ì‚¬ìš©ì : ì»´í“¨í„°</div>

  <div style="margin-top:8px">
    í˜„ì¬ ì°¨ë¡€: <b id="turnPlayer"></b>
  </div>
  <div>í„´ ìˆ˜: <b id="turnCount">0</b></div>

  <div id="message" class="box"></div>

  <input type="number" id="guessInput" placeholder="1~100 ì…ë ¥">
  <button id="submitBtn">í™•ì¸</button>

  <h4>ğŸ“œ í˜„ì¬ ê²Œì„ ë¡œê·¸</h4>
  <div class="log" id="roundLog"></div>

  <h4>ğŸ“š ê²Œì„ ê¸°ë¡</h4>
  <div class="log" id="gameLog"></div>
</div>

<script>
const KEY = "updown_optimal_v2";

function newRound() {
  return {
    answer: Math.floor(Math.random()*100) + 1,
    low: 1,
    high: 100,
    turn: 0,
    playerTurn: true,
    log: [],
    over: false
  };
}

function loadData() {
  return JSON.parse(localStorage.getItem(KEY)) || {
    playerScore: 0,
    computerScore: 0,
    games: [],
    round: newRound()
  };
}

let data = loadData();

function save() {
  // í•­ìƒ ìµœì‹  ìƒíƒœ ê¸°ì¤€ìœ¼ë¡œ ì €ì¥
  localStorage.setItem(KEY, JSON.stringify(data));
}

function updateUI(msg="") {
  document.getElementById("pscore").textContent = data.playerScore;
  document.getElementById("cscore").textContent = data.computerScore;
  document.getElementById("turnPlayer").textContent =
    data.round.playerTurn ? "ì‚¬ìš©ì" : "ì»´í“¨í„°";
  document.getElementById("turnCount").textContent = data.round.turn;
  document.getElementById("message").textContent = msg;

  document.getElementById("roundLog").innerHTML =
    data.round.log.map(x => `<div>${x}</div>`).join("");

  document.getElementById("gameLog").innerHTML =
    data.games.map((g,i) => `<div>ê²Œì„ ${i+1}: ${g}</div>`).join("");
}

function endGame(winner) {
  if (winner === "ì‚¬ìš©ì") data.playerScore++;
  else data.computerScore++;

  data.games.unshift(
    `${winner} ìŠ¹ (ì •ë‹µ ${data.round.answer}, ${data.round.turn}í„´)`
  );

  data.round.over = true;
  save();
  updateUI(`ğŸ‰ ${winner} ì •ë‹µ! ì •ë‹µì€ ${data.round.answer}`);

  setTimeout(() => {
    data.round = newRound();
    save();
    updateUI("ìƒˆ ê²Œì„ ì‹œì‘!");
  }, 1200);
}

function processGuess(who, guess) {
  if (data.round.over) return;

  data.round.turn++;
  let result;

  if (guess < data.round.answer) {
    result = "UP";
    data.round.low = Math.max(data.round.low, guess + 1);
  } else if (guess > data.round.answer) {
    result = "DOWN";
    data.round.high = Math.min(data.round.high, guess - 1);
  } else {
    result = "CORRECT";
  }

  data.round.log.unshift(`${who}: ${guess} â†’ ${result}`);

  if (result === "CORRECT") {
    endGame(who);
    return;
  }

  data.round.playerTurn = !data.round.playerTurn;
  save();
  updateUI(`${who}: ${guess} â†’ ${result}`);

  if (!data.round.playerTurn) computerGuess();
}

function computerGuess() {
  if (data.round.over) return;
  const guess = Math.floor((data.round.low + data.round.high) / 2);
  setTimeout(() => processGuess("ì»´í“¨í„°", guess), 600);
}

document.getElementById("submitBtn").onclick = () => {
  if (!data.round.playerTurn || data.round.over) return;

  const num = Number(document.getElementById("guessInput").value);
  document.getElementById("guessInput").value = "";

  if (!Number.isInteger(num) || num < 1 || num > 100) {
    updateUI("â— 1~100 ì‚¬ì´ì˜ ì •ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”");
    return;
  }

  processGuess("ì‚¬ìš©ì", num);
};

/* ğŸ”¥ í•µì‹¬: ë‹¤ë¥¸ ì°½ê³¼ ì‹¤ì‹œê°„ ë™ê¸°í™” */
window.addEventListener("storage", (e) => {
  if (e.key === KEY && e.newValue) {
    data = JSON.parse(e.newValue);
    updateUI("ğŸ”„ ë‹¤ë¥¸ ì°½ê³¼ ë™ê¸°í™”ë¨");
  }
});

updateUI("ê²Œì„ ì‹œì‘!");
</script>

</body>
</html>
