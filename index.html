<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Up Down ê²Œì„ (ìµœì¢… ì•ˆì •íŒ)</title>
<style>
  :root{
    --bg:#f6f7fb;
    --card:#ffffff;
    --muted:#666;
    --accent:#1363df;
  }

  html,body{height:100%}
  body{
    margin:0;
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Helvetica Neue",Arial;
    background:var(--bg);
    padding:28px;
    color:#111;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  .container{
    max-width:1300px;           /* wider */
    margin:0 auto;
    background:var(--card);
    padding:28px;
    border-radius:14px;
    box-shadow:0 20px 40px rgba(12,20,40,0.06);
  }

  h2{margin:0 0 12px 0}

  /* grid: left game, right logs */
  .grid{
    display:grid;
    grid-template-columns: 1.15fr 1fr;
    gap:28px;
    align-items:start;
  }

  /* Left column */
  .game{display:flex;flex-direction:column;gap:12px}

  /* Scoreboard block */
  .score-row{
    display:flex;
    align-items:center;
    gap:18px;
    flex-wrap:wrap;
  }

  .score-box{
    display:flex;
    align-items:center;
    gap:12px;
  }

  .score{
    font-size:56px;           /* much bigger */
    font-weight:900;
    letter-spacing:0.6px;
  }

  .vs{
    font-size:20px;
    color:var(--muted);
    font-weight:700;
  }

  .label{
    font-size:22px;           /* label larger */
    font-weight:800;
    color:var(--muted);
  }

  .meta-row{display:flex;gap:16px;align-items:center;flex-wrap:wrap;font-size:16px;color:var(--muted)}

  /* message */
  .box{
    background:#f1f1f1;
    padding:14px;
    border-radius:10px;
    min-height:44px;
    display:flex;
    align-items:center;
    font-size:16px;
  }

  /* input & button */
  .controls{display:flex;gap:10px;flex-direction:column}
  input[type="text"], button{
    box-sizing:border-box;
    width:100%;
    padding:14px;
    font-size:18px;
    border-radius:10px;
    border:1px solid #d6d6d6;
  }

  /* remove spinner reliability: using text input */
  input[type="text"]{-webkit-appearance:none;appearance:none}
  input[type="text"]::placeholder{color:#999}

  button{
    background:#fafafa;
    cursor:pointer;
    font-weight:700;
  }
  button:disabled{opacity:0.6;cursor:not-allowed}

  /* logs column */
  .logs{display:flex;flex-direction:column;gap:12px}
  .log{
    background:#fafafa;
    padding:12px;
    border-radius:10px;
    max-height:420px;
    overflow:auto;
    font-size:15px;
    white-space:pre-wrap;
    border:1px solid #efefef;
  }

  /* responsive */
  @media (max-width:900px){
    .grid{grid-template-columns:1fr}
    .score{font-size:42px}
    .label{font-size:18px}
  }

  /* subtle focus */
  input:focus, button:focus{outline:3px solid rgba(19,99,223,0.12);outline-offset:2px}
</style>
</head>
<body>
  <div class="container">
    <h2>Up Down ê²Œì„ (1~100)</h2>
    <div class="grid">
      <!-- LEFT: Game -->
      <div class="game">
        <div class="score-row">
          <div class="score-box">
            <div class="score"><span id="pscore">0</span> : <span id="cscore">0</span></div>
          </div>
          <div>
            <div class="label">ë³´ì •ê³  : ì»´í“¨í„°</div>
            <div class="meta-row" style="margin-top:6px">
              <div>í˜„ì¬ ì°¨ë¡€: <strong id="turnPlayer"></strong></div>
              <div>í„´ ìˆ˜: <strong id="turnCount">0</strong></div>
            </div>
          </div>
        </div>

        <div id="message" class="box" aria-live="polite">ê²Œì„ ì‹œì‘!</div>

        <div class="controls" style="margin-top:6px">
          <!-- use text to reliably remove spinner; inputmode keeps numeric keys on mobile -->
          <input id="guessInput" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="1~100 ì…ë ¥" aria-label="ìˆ«ì ì…ë ¥ (1~100)">
          <button id="submitBtn" type="button">í™•ì¸</button>
        </div>
      </div>

      <!-- RIGHT: Logs -->
      <div class="logs">
        <div>
          <h4 style="margin:8px 0">ğŸ“œ í˜„ì¬ ê²Œì„ ë¡œê·¸</h4>
          <div class="log" id="roundLog"></div>
        </div>

        <div>
          <h4 style="margin:8px 0">ğŸ“š ê²Œì„ ê¸°ë¡</h4>
          <div class="log" id="gameLog"></div>
        </div>
      </div>
    </div>
  </div>

<script>
  const POST_RESULT_DELAY = 2000; // 2 seconds
  
  const KEY = "updown_optimal_v1";

  // DOM refs
  const pscore = document.getElementById('pscore');
  const cscore = document.getElementById('cscore');
  const turnPlayer = document.getElementById('turnPlayer');
  const turnCount = document.getElementById('turnCount');
  const message = document.getElementById('message');
  const guessInput = document.getElementById('guessInput');
  const submitBtn = document.getElementById('submitBtn');
  const roundLog = document.getElementById('roundLog');
  const gameLog = document.getElementById('gameLog');

  // data helpers
  function newRound(){
    return {
      answer: Math.floor(Math.random()*100)+1,
      low:1, high:100,
      turn:0,
      playerTurn:true,
      log:[],
      over:false
    };
  }

  function load(){
    const raw = localStorage.getItem(KEY);
    if(raw){
      try{return JSON.parse(raw);}catch(e){console.warn('parse err, resetting');}
    }
    return {playerScore:0, computerScore:0, games:[], round: newRound()};
  }

  let data = load();
  let countdownTimer = null;

  function save(){ localStorage.setItem(KEY, JSON.stringify(data)); }

  function render(msg = ""){
    pscore.textContent = data.playerScore;
    cscore.textContent = data.computerScore;
    turnPlayer.textContent = data.round.playerTurn ? "ë³´ì •ê³ " : "ì»´í“¨í„°";
    turnCount.textContent = data.round.turn;
    if(msg !== "") message.textContent = msg;

    roundLog.innerHTML = data.round.log.map(line => `<div>${escapeHtml(line)}</div>`).join('');
    gameLog.innerHTML = data.games.map((g,i)=>`<div>ê²Œì„ ${i+1}: ${escapeHtml(g)}</div>`).join('');

    guessInput.disabled = !!data.round.over;
    submitBtn.disabled = !!data.round.over;
  }

  // small utility to avoid xss when showing logs (keeps text-only)
  function escapeHtml(s){
    return String(s).replace(/[&<>"']/g, function(m){ return { '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
  }

  // end game with visible 5-second countdown
  function endGame(winner){
    if(winner === "ë³´ì •ê³ ") data.playerScore++; else data.computerScore++;
    data.games.unshift(`${winner} ìŠ¹ (ì •ë‹µ ${data.round.answer}, ${data.round.turn}í„´)`);
    data.round.over = true;
    save();

    let remaining = 5;
    render(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
    if(countdownTimer) clearInterval(countdownTimer);
    countdownTimer = setInterval(()=>{
      remaining--;
      if(remaining > 0){
        render(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
      } else {
        clearInterval(countdownTimer);
        countdownTimer = null;
        data.round = newRound();
        save();
        render("ìƒˆ ê²Œì„ ì‹œì‘!");
      }
    }, 1000);
  }

  function processGuess(who, guess) {
    if (data.round.over) return;
  
    data.round.turn++;
    let result;
  
    if (guess < data.round.answer) {
      result = "UP";
      data.round.low = Math.max(data.round.low, guess + 1);
    } else if (guess > data.round.answer) {
      result = "DOWN";
      data.round.high = Math.min(data.round.high, guess - 1);
    } else {
      result = "CORRECT";
    }
  
    data.round.log.unshift(`${who}: ${guess} â†’ ${result}`);
    save();
  
    // Show result immediately
    updateUI(`${who}: ${guess} â†’ ${result}`);
  
    // If correct, end game immediately (countdown handles delay)
    if (result === "CORRECT") {
      endGame(who);
      return;
    }
  
    // â±ï¸ WAIT 2 seconds BEFORE continuing
    guessInput.disabled = true;
    submitBtn.disabled = true;
  
    setTimeout(() => {
      data.round.playerTurn = !data.round.playerTurn;
      save();
      updateUI();
  
      if (!data.round.playerTurn) {
        computerGuess();
      }
    }, POST_RESULT_DELAY);
  }


  function computerGuess(){
    if(data.round.low > data.round.high){
      data.round.low = 1; data.round.high = 100;
    }
    const guess = Math.floor((data.round.low + data.round.high)/2);
    setTimeout(()=> processGuess("ì»´í“¨í„°", guess), 700);
  }

  // submit handler (parses input safely)
  function handleSubmit(){
    if(!data.round.playerTurn || data.round.over) return;
    const raw = guessInput.value.trim();
    // allow empty -> rejects
    // parse as integer (decimal allowed but must be integer)
    if(raw === "") { render("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥"); return; }
    const n = Number(raw);
    // disallow non-integer / NaN
    if(!Number.isInteger(n) || n < 1 || n > 100){
      render("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥");
      guessInput.value = "";
      return;
    }
    guessInput.value = "";
    processGuess("ë³´ì •ê³ ", n);
  }

  submitBtn.addEventListener('click', handleSubmit);

  // Enter key on input submits
  guessInput.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){
      e.preventDefault();
      handleSubmit();
    }
  });

  // Enter on the button too
  submitBtn.addEventListener('keydown', (e) => {
    if(e.key === 'Enter'){
      e.preventDefault();
      handleSubmit();
    }
  });

  // multi-tab sync
  window.addEventListener('storage', (e) => {
    if(e.key === KEY && e.newValue){
      try{ data = JSON.parse(e.newValue); render("ğŸ”„ ë‹¤ë¥¸ ì°½ê³¼ ë™ê¸°í™”ë¨"); }
      catch(err){ console.warn('storage parse fail'); }
    }
  });

  // initial render
  render("ê²Œì„ ì‹œì‘!");
</script>
</body>
</html>
