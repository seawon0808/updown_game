<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Up Down ê²Œì„ (ìµœì¢… ì•ˆì •íŒ)</title>

<style>
body {
  font-family: system-ui, sans-serif;
  background:#f6f7fb;
  padding:40px;
  font-size:18px;
}

/* MAIN CONTAINER */
.container {
  max-width:1200px;
  margin:auto;
  background:white;
  padding:32px;
  border-radius:16px;
  box-shadow:0 15px 30px rgba(0,0,0,.1);
}

/* GRID LAYOUT */
.grid {
  display:grid;
  grid-template-columns: 1.1fr 1fr;
  gap:32px;
  margin-top:20px;
}

/* LEFT: GAME */
.game {
  display:flex;
  flex-direction:column;
}

/* RIGHT: LOGS */
.logs {
  display:flex;
  flex-direction:column;
}

/* INPUTS */
input, button {
  width:100%;
  padding:14px;
  margin-top:10px;
  font-size:18px;
}

button {
  border-radius:10px;
  border:1px solid #ccc;
  background:#fafafa;
  cursor:pointer;
}

button:disabled,
input:disabled {
  background:#eee;
  cursor:not-allowed;
}

/* BOXES */
.box {
  background:#f1f1f1;
  padding:14px;
  border-radius:8px;
  margin-top:12px;
}

.log {
  background:#f6f6f6;
  padding:12px;
  border-radius:8px;
  margin-bottom:16px;
  max-height:260px;
  overflow-y:auto;
  font-size:16px;
  white-space:pre-wrap;
}

.score {
  font-size:24px;
  margin-top:10px;
}

.small {
  font-size:14px;
  color:#555;
}

/* MOBILE */
@media (max-width: 900px) {
  .grid {
    grid-template-columns: 1fr;
  }
}
</style>
</head>

<body>

<div class="container">
  <h2>Up Down ê²Œì„ (1~100)</h2>

  <div class="grid">

    <!-- LEFT: GAME -->
    <div class="game">
      <div class="score">
        <b id="pscore">0</b> : <b id="cscore">0</b>
      </div>
      <div class="small">ë³´ì •ê³  : ì»´í“¨í„°</div>

      <div style="margin-top:12px">
        í˜„ì¬ ì°¨ë¡€: <b id="turnPlayer"></b>
      </div>
      <div>í„´ ìˆ˜: <b id="turnCount">0</b></div>

      <div id="message" class="box"></div>

      <input type="number" id="guessInput" placeholder="1~100 ì…ë ¥">
      <button id="submitBtn">í™•ì¸</button>
    </div>

    <!-- RIGHT: LOGS -->
    <div class="logs">
      <h4>ğŸ“œ í˜„ì¬ ê²Œì„ ë¡œê·¸</h4>
      <div class="log" id="roundLog"></div>

      <h4>ğŸ“š ê²Œì„ ê¸°ë¡</h4>
      <div class="log" id="gameLog"></div>
    </div>

  </div>
</div>

<script>
const KEY = "updown_optimal_v1";

/* DOM refs (fixed) */
const pscore = document.getElementById('pscore');
const cscore = document.getElementById('cscore');
const turnPlayer = document.getElementById('turnPlayer');
const turnCount = document.getElementById('turnCount');
const message = document.getElementById('message');
const guessInput = document.getElementById('guessInput');
const submitBtn = document.getElementById('submitBtn');
const roundLog = document.getElementById('roundLog');
const gameLog = document.getElementById('gameLog');

/* ---------- DATA ---------- */
function newRound() {
  return {
    answer: Math.floor(Math.random()*100)+1,
    low: 1,
    high: 100,
    turn: 0,
    playerTurn: true,
    log: [],
    over: false
  };
}

function load() {
  const saved = localStorage.getItem(KEY);
  if (saved) {
    try {
      return JSON.parse(saved);
    } catch (e) {
      console.warn("localStorage parse failed, resetting data");
    }
  }
  return {
    playerScore: 0,
    computerScore: 0,
    games: [],
    round: newRound()
  };
}

let data = load();
let countdownInterval = null;

function save() {
  localStorage.setItem(KEY, JSON.stringify(data));
}

/* ---------- UI ---------- */
function updateUI(msg="") {
  pscore.textContent = data.playerScore;
  cscore.textContent = data.computerScore;
  turnPlayer.textContent = data.round.playerTurn ? "ë³´ì •ê³ " : "ì»´í“¨í„°";
  turnCount.textContent = data.round.turn;
  message.textContent = msg;

  roundLog.innerHTML = data.round.log.map(x => `<div>${x}</div>`).join("");
  gameLog.innerHTML = data.games.map((g,i)=>`<div>ê²Œì„ ${i+1}: ${g}</div>`).join("");

  // disable inputs while round is over (during countdown)
  guessInput.disabled = !!data.round.over;
  submitBtn.disabled = !!data.round.over;
}

/* ---------- GAME END (with 5s countdown) ---------- */
function endGame(winner) {
  if (winner === "ë³´ì •ê³ ") data.playerScore++;
  else data.computerScore++;

  data.games.unshift(
    `${winner} ìŠ¹ (ì •ë‹µ ${data.round.answer}, ${data.round.turn}í„´)`
  );

  data.round.over = true;
  save();

  // Start a visible countdown from 5 down to 1
  let remaining = 5;
  updateUI(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
  if (countdownInterval) clearInterval(countdownInterval);
  countdownInterval = setInterval(() => {
    remaining--;
    if (remaining > 0) {
      updateUI(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
    } else {
      clearInterval(countdownInterval);
      countdownInterval = null;
      data.round = newRound();
      save();
      updateUI("ìƒˆ ê²Œì„ ì‹œì‘!");
    }
  }, 1000);
}

/* ---------- GUESS ---------- */
function processGuess(who, guess) {
  if (data.round.over) return;

  data.round.turn++;
  let result;

  if (guess < data.round.answer) {
    result = "UP";
    data.round.low = Math.max(data.round.low, guess + 1);
  } else if (guess > data.round.answer) {
    result = "DOWN";
    data.round.high = Math.min(data.round.high, guess - 1);
  } else {
    result = "CORRECT";
  }

  data.round.log.unshift(`${who}: ${guess} â†’ ${result}`);

  if (result === "CORRECT") {
    endGame(who);
    return;
  }

  data.round.playerTurn = !data.round.playerTurn;
  save();
  updateUI(`${who}: ${guess} â†’ ${result}`);

  if (!data.round.playerTurn) computerGuess();
}

/* ---------- COMPUTER ---------- */
function computerGuess() {
  // safety: if low > high (shouldn't happen), reset range
  if (data.round.low > data.round.high) {
    data.round.low = 1;
    data.round.high = 100;
  }
  const guess = Math.floor((data.round.low + data.round.high) / 2);
  // small delay so user can see the message
  setTimeout(() => processGuess("ì»´í“¨í„°", guess), 800);
}

/* ---------- INPUT ---------- */
submitBtn.onclick = () => {
  if (!data.round.playerTurn || data.round.over) return;

  const num = Number(guessInput.value);
  guessInput.value = "";

  if (!Number.isInteger(num) || num < 1 || num > 100) {
    updateUI("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥");
    return;
  }
  processGuess("ë³´ì •ê³ ", num);
};

/* ---------- MULTI TAB SYNC ---------- */
window.addEventListener("storage", e => {
  if (e.key === KEY && e.newValue) {
    try {
      data = JSON.parse(e.newValue);
      updateUI("ğŸ”„ ë‹¤ë¥¸ ì°½ê³¼ ë™ê¸°í™”ë¨");
    } catch (err) {
      console.warn("failed parsing storage event");
    }
  }
});

/* initial render */
updateUI("ê²Œì„ ì‹œì‘!");
</script>

</body>
</html>
