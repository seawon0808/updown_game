<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Up Down ê²Œì„ â€” ì•ˆì •íŒ</title>
<style>
  :root{
    --bg:#f6f7fb;
    --card:#fff;
    --muted:#666;
  }
  html,body{height:100%;margin:0}
  body{
    font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial;
    background:var(--bg);
    padding:28px;
    color:#111;
  }

  .container{
    max-width:1300px;
    margin:0 auto;
    background:var(--card);
    padding:28px;
    border-radius:14px;
    box-shadow:0 20px 40px rgba(0,0,0,0.06);
  }

  h2{margin:0 0 12px 0}

  .grid{
    display:grid;
    grid-template-columns:1.15fr 1fr;
    gap:28px;
    align-items:start;
  }

  @media (max-width:900px){
    .grid{grid-template-columns:1fr}
  }

  .score-row{display:flex;align-items:center;gap:18px;flex-wrap:wrap}
  .score{font-size:56px;font-weight:900;letter-spacing:0.5px}
  .label{font-size:22px;font-weight:800;color:var(--muted)}
  .meta{display:flex;gap:16px;margin-top:6px;color:var(--muted);font-size:16px}

  .box{background:#f1f1f1;padding:14px;border-radius:10px;min-height:44px;display:flex;align-items:center;font-size:16px}

  .controls{display:flex;flex-direction:column;gap:10px}
  input[type="text"], button{
    box-sizing:border-box;padding:14px;font-size:18px;border-radius:10px;border:1px solid #d6d6d6;width:100%;
  }
  input[type="text"]{-webkit-appearance:none;appearance:none}
  input[type="text"]::placeholder{color:#999}
  button{background:#fafafa;cursor:pointer;font-weight:700}
  button:disabled{opacity:0.6;cursor:not-allowed}

  .logs{display:flex;flex-direction:column;gap:12px}
  .log{background:#fafafa;padding:12px;border-radius:10px;max-height:420px;overflow:auto;font-size:15px;white-space:pre-wrap;border:1px solid #efefef}

  input:focus, button:focus{outline:3px solid rgba(19,99,223,0.12);outline-offset:2px}
</style>
</head>
<body>
  <div class="container">
    <h2>Up Down ê²Œì„ (1~100)</h2>

    <div class="grid">
      <!-- LEFT -->
      <div class="game">
        <div class="score-row">
          <div class="score"><span id="pscore">0</span> : <span id="cscore">0</span></div>
          <div>
            <div class="label">ë³´ì •ê³  : ì»´í“¨í„°</div>
            <div class="meta">
              <div>í˜„ì¬ ì°¨ë¡€: <strong id="turnPlayer"></strong></div>
              <div>í„´ ìˆ˜: <strong id="turnCount">0</strong></div>
            </div>
          </div>
        </div>

        <div id="message" class="box" aria-live="polite">ê²Œì„ ì‹œì‘!</div>

        <div class="controls" style="margin-top:6px">
          <!-- use text to remove spinners; inputmode keeps numeric keyboard on mobile -->
          <input id="guessInput" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="1~100 ì…ë ¥" aria-label="ìˆ«ì ì…ë ¥ (1~100)">
          <button id="submitBtn" type="button">í™•ì¸</button>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="logs">
        <div>
          <h4 style="margin:8px 0">ğŸ“œ í˜„ì¬ ê²Œì„ ë¡œê·¸</h4>
          <div class="log" id="roundLog"></div>
        </div>

        <div>
          <h4 style="margin:8px 0">ğŸ“š ê²Œì„ ê¸°ë¡</h4>
          <div class="log" id="gameLog"></div>
        </div>
      </div>
    </div>
  </div>

<script>
/* ---------- CONFIG ---------- */
const STORAGE_KEY = "updown_optimal_v1";
const POST_RESULT_DELAY = 2000;      // 2 seconds to read the result
const COMPUTER_THINK_DELAY = 800;    // computer "thinking" animation

/* ---------- DOM REFS ---------- */
const el = id => document.getElementById(id);
const pscore = el('pscore');
const cscore = el('cscore');
const turnPlayer = el('turnPlayer');
const turnCount = el('turnCount');
const message = el('message');
const guessInput = el('guessInput');
const submitBtn = el('submitBtn');
const roundLog = el('roundLog');
const gameLog = el('gameLog');

/* ---------- UTILITIES ---------- */
function escapeHtml(s){
  return String(s).replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));
}

/* ---------- GAME DATA ---------- */
function newRound(){
  return { answer: Math.floor(Math.random()*100)+1, low:1, high:100, turn:0, playerTurn:true, log:[], over:false };
}

function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    try { return JSON.parse(raw); } catch(e){ console.warn("Storage parse failed, reset."); }
  }
  return { playerScore:0, computerScore:0, games:[], round:newRound() };
}

let data = load();
let countdownInterval = null;

function save(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(data)); }

/* ---------- RENDER ---------- */
function render(msg){
  pscore.textContent = data.playerScore;
  cscore.textContent = data.computerScore;
  turnPlayer.textContent = data.round.playerTurn ? "ë³´ì •ê³ " : "ì»´í“¨í„°";
  turnCount.textContent = data.round.turn;
  if(typeof msg === 'string' && msg !== "") message.textContent = msg;

  roundLog.innerHTML = data.round.log.map(line => `<div>${escapeHtml(line)}</div>`).join('');
  gameLog.innerHTML = data.games.map((g,i) => `<div>ê²Œì„ ${i+1}: ${escapeHtml(g)}</div>`).join('');

  // disable inputs while round is over (end-game countdown)
  const disabled = !!data.round.over;
  guessInput.disabled = disabled;
  submitBtn.disabled = disabled;
}

/* ---------- END GAME ---------- */
function endGame(winner){
  if(winner === "ë³´ì •ê³ ") data.playerScore++; else data.computerScore++;
  data.games.unshift(`${winner} ìŠ¹ (ì •ë‹µ ${data.round.answer}, ${data.round.turn}í„´)`);
  data.round.over = true;
  save();

  // 5 second countdown display
  let remaining = 5;
  render(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
  if(countdownInterval) clearInterval(countdownInterval);
  countdownInterval = setInterval(()=>{
    remaining--;
    if(remaining > 0){
      render(`ğŸ‰ ${winner} ì •ë‹µ! ${remaining}ì´ˆ í›„ ìƒˆ ê²Œì„ ì‹œì‘`);
    } else {
      clearInterval(countdownInterval);
      countdownInterval = null;
      data.round = newRound();
      save();
      render("ìƒˆ ê²Œì„ ì‹œì‘!");
    }
  }, 1000);
}

/* ---------- PROCESS GUESS ----------
   Shows result immediately, then waits POST_RESULT_DELAY before switching turn
   and calling computerGuess() if needed. Inputs are locked during the read period.
*/
function processGuess(who, guess) {
  if (data.round.over) return;

  data.round.turn++;
  let result;

  if (guess < data.round.answer) {
    result = "UP";
    data.round.low = Math.max(data.round.low, guess + 1);
  } else if (guess > data.round.answer) {
    result = "DOWN";
    data.round.high = Math.min(data.round.high, guess - 1);
  } else {
    result = "CORRECT";
  }

  data.round.log.unshift(`${who}: ${guess} â†’ ${result}`);
  save();

  // Show result immediately so user can read it
  render(`${who}: ${guess} â†’ ${result}`);

  // If correct, end the round (endGame handles countdown and disables input)
  if (result === "CORRECT") {
    endGame(who);
    return;
  }

  // Lock inputs for reading period
  guessInput.disabled = true;
  submitBtn.disabled = true;

  // After read delay, switch turn and continue
  setTimeout(() => {
    data.round.playerTurn = !data.round.playerTurn;
    // Re-enable only if round is not over
    guessInput.disabled = !!data.round.over;
    submitBtn.disabled = !!data.round.over;
    save();
    render(); // no new message, just full UI update

    if (!data.round.playerTurn && !data.round.over) {
      // computer's turn immediately calls the computer thinking delay
      computerGuess();
    }
  }, POST_RESULT_DELAY);
}

/* ---------- COMPUTER GUESS ---------- */
function computerGuess() {
  // safety: ensure valid range
  if (data.round.low > data.round.high) { data.round.low = 1; data.round.high = 100; }

  const guess = Math.floor((data.round.low + data.round.high) / 2);
  // computer "thinks" then its guess is processed (processGuess will show result and lock 2s)
  setTimeout(() => processGuess("ì»´í“¨í„°", guess), COMPUTER_THINK_DELAY);
}

/* ---------- INPUT SUBMISSION ---------- */
function handleSubmit(){
  // only allow when it's player's turn and round not over
  if (!data.round.playerTurn || data.round.over) return;

  const raw = String(guessInput.value || "").trim();
  // quick validation
  if (raw === "") { render("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥"); return; }

  // parse integer (allow "007" etc). Use Number then Number.isInteger
  const n = Number(raw);
  // reject NaN, non-integer, out-of-range
  if (!Number.isInteger(n) || n < 1 || n > 100) {
    render("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥");
    guessInput.value = "";
    return;
  }

  // clear the input immediately (nice UX)
  guessInput.value = "";
  // Directly process the player's guess; processGuess handles locking & delay
  processGuess("ë³´ì •ê³ ", n);
}

/* ---------- EVENTS ---------- */
submitBtn.addEventListener('click', handleSubmit);

// Enter key in input should submit
guessInput.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleSubmit();
  }
});

// support Enter on focused button as well
submitBtn.addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    e.preventDefault();
    handleSubmit();
  }
});

/* ---------- MULTI-TAB SYNC ---------- */
window.addEventListener('storage', (e) => {
  if (e.key === STORAGE_KEY && e.newValue) {
    try {
      data = JSON.parse(e.newValue);
      render("ğŸ”„ ë‹¤ë¥¸ ì°½ê³¼ ë™ê¸°í™”ë¨");
    } catch (err) {
      console.warn('storage parse failed');
    }
  }
});

/* ---------- INITIAL RENDER ---------- */
render("ê²Œì„ ì‹œì‘!");
</script>
</body>
</html>
