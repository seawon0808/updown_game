<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Up Down ê²Œì„</title>

<style>
body{
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",Arial;
  background:#f6f7fb;
  padding:24px;
  margin:0;
}

.container{
  max-width:1200px;
  margin:auto;
  background:#fff;
  padding:24px;
  border-radius:14px;
  box-shadow:0 18px 36px rgba(0,0,0,.08);
}

.grid{
  display:grid;
  grid-template-columns:1.2fr 1fr;
  gap:24px;
}
@media(max-width:900px){
  .grid{grid-template-columns:1fr}
}

.score{
  font-size:56px;
  font-weight:900;
}
.label{
  font-size:22px;
  font-weight:800;
  color:#555;
}
.meta{
  display:flex;
  gap:16px;
  margin-top:6px;
  color:#666;
  font-size:16px;
}

.box{
  background:#f1f1f1;
  padding:14px;
  border-radius:10px;
  margin:12px 0;
  min-height:44px;
  display:flex;
  align-items:center;
}

input, button{
  width:100%;
  padding:14px;
  font-size:18px;
  border-radius:10px;
  border:1px solid #ccc;
}
input{
  -webkit-appearance:none;
  appearance:none;
}
button{
  background:#fafafa;
  font-weight:700;
  cursor:pointer;
}
button:disabled,
input:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.logs h4{margin:8px 0}
.log{
  background:#fafafa;
  padding:12px;
  border-radius:10px;
  max-height:360px;
  overflow:auto;
  font-size:15px;
  border:1px solid #eee;
}
</style>
</head>
<body>

<div class="container">
  <h2>Up Down ê²Œì„ (1~100)</h2>

  <div class="grid">
    <!-- LEFT -->
    <div>
      <div style="display:flex;gap:20px;align-items:center;flex-wrap:wrap">
        <div class="score">
          <span id="pscore">0</span> : <span id="cscore">0</span>
        </div>
        <div>
          <div class="label">ë³´ì •ê³  : ì»´í“¨í„°</div>
          <div class="meta">
            <div>í˜„ì¬ ì°¨ë¡€: <b id="turnPlayer"></b></div>
            <div>í„´ ìˆ˜: <b id="turnCount">0</b></div>
          </div>
        </div>
      </div>

      <div id="message" class="box">ê²Œì„ ì‹œì‘!</div>

      <input
        id="guessInput"
        type="text"
        inputmode="numeric"
        pattern="[0-9]*"
        placeholder="1~100 ì…ë ¥"
      >
      <button id="submitBtn">í™•ì¸</button>
    </div>

    <!-- RIGHT -->
    <div class="logs">
      <h4>ğŸ“œ í˜„ì¬ ê²Œì„ ë¡œê·¸</h4>
      <div class="log" id="roundLog"></div>

      <h4>ğŸ“š ê²Œì„ ê¸°ë¡</h4>
      <div class="log" id="gameLog"></div>
    </div>
  </div>
</div>

<script>
const STORAGE_KEY = "updown_final_v1";
const READ_DELAY = 2000;
const COMPUTER_DELAY = 800;

const el = id => document.getElementById(id);
const pscore = el("pscore");
const cscore = el("cscore");
const turnPlayer = el("turnPlayer");
const turnCount = el("turnCount");
const message = el("message");
const guessInput = el("guessInput");
const submitBtn = el("submitBtn");
const roundLog = el("roundLog");
const gameLog = el("gameLog");

function newRound(){
  return {
    answer: Math.floor(Math.random()*100)+1,
    low:1,
    high:100,
    turn:0,
    playerTurn:true,
    log:[],
    over:false
  };
}

let data = load();

function load(){
  const raw = localStorage.getItem(STORAGE_KEY);
  if(raw){
    try{
      const d = JSON.parse(raw);
      if(!d.round || d.round.over) d.round = newRound();
      return d;
    }catch{}
  }
  return {playerScore:0, computerScore:0, games:[], round:newRound()};
}

function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
}

function render(msg){
  pscore.textContent = data.playerScore;
  cscore.textContent = data.computerScore;
  turnPlayer.textContent = data.round.playerTurn ? "ë³´ì •ê³ " : "ì»´í“¨í„°";
  turnCount.textContent = data.round.turn;
  if(msg) message.textContent = msg;

  roundLog.innerHTML = data.round.log.map(x=>`<div>${x}</div>`).join("");
  gameLog.innerHTML = data.games.map((g,i)=>`<div>ê²Œì„ ${i+1}: ${g}</div>`).join("");

  guessInput.disabled = data.round.over;
  submitBtn.disabled = data.round.over;
}

function endGame(winner){
  if(winner==="ë³´ì •ê³ ") data.playerScore++;
  else data.computerScore++;

  data.games.unshift(
    `${winner} ìŠ¹ (ì •ë‹µ ${data.round.answer}, ${data.round.turn}í„´)`
  );
  data.round.over = true;
  save();

  let t = 5;
  const timer = setInterval(()=>{
    message.textContent = `ğŸ‰ ${winner} ì •ë‹µ! ${t}ì´ˆ í›„ ìƒˆ ê²Œì„`;
    if(--t<0){
      clearInterval(timer);
      data.round = newRound();
      save();
      render("ìƒˆ ê²Œì„ ì‹œì‘!");
    }
  },1000);
}

function processGuess(who, guess){
  if(data.round.over) return;

  data.round.turn++;
  let result;

  if(guess < data.round.answer){
    result="UP";
    data.round.low = Math.max(data.round.low, guess+1);
  }else if(guess > data.round.answer){
    result="DOWN";
    data.round.high = Math.min(data.round.high, guess-1);
  }else{
    result="CORRECT";
  }

  data.round.log.unshift(`${who}: ${guess} â†’ ${result}`);
  save();
  render(`${who}: ${guess} â†’ ${result}`);

  if(result==="CORRECT"){
    endGame(who);
    return;
  }

  guessInput.disabled = true;
  submitBtn.disabled = true;

  setTimeout(()=>{
    data.round.playerTurn = !data.round.playerTurn;
    guessInput.disabled = false;
    submitBtn.disabled = false;
    save();
    render();

    if(!data.round.playerTurn){
      computerGuess();
    }
  }, READ_DELAY);
}

function computerGuess(){
  const guess = Math.floor((data.round.low + data.round.high)/2);
  setTimeout(()=>processGuess("ì»´í“¨í„°", guess), COMPUTER_DELAY);
}

function handleSubmit(){
  if(data.round.over) return;

  const v = guessInput.value.trim();
  if(!v) return;

  const n = Number(v);
  if(!Number.isInteger(n) || n<1 || n>100){
    render("â— 1~100 ì‚¬ì´ ìˆ«ìë§Œ ì…ë ¥");
    guessInput.value="";
    return;
  }

  guessInput.value="";
  processGuess("ë³´ì •ê³ ", n);
}

submitBtn.onclick = handleSubmit;
guessInput.addEventListener("keydown", e=>{
  if(e.key==="Enter"){
    e.preventDefault();
    handleSubmit();
  }
});

render("ê²Œì„ ì‹œì‘!");
</script>

</body>
</html>
